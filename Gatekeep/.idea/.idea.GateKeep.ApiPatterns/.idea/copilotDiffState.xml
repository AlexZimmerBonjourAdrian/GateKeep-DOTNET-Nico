<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/src/GateKeep.Api/Endpoints/Notificaciones/NotificacionEndpoints.cs">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/GateKeep.Api/Endpoints/Notificaciones/NotificacionEndpoints.cs" />
              <option name="originalContent" value="using GateKeep.Api.Application.Notificaciones;&#10;using GateKeep.Api.Contracts.Notificaciones;&#10;using Microsoft.AspNetCore.Mvc;&#10;using System.Security.Claims;&#10;&#10;namespace GateKeep.Api.Endpoints.Notificaciones;&#10;&#10;public static class NotificacionEndpoints&#10;{&#10;    public static void MapNotificacionEndpoints(this WebApplication app)&#10;    {&#10;        var group = app.MapGroup(&quot;/api/notificaciones&quot;)&#10;            .WithTags(&quot;Notificaciones&quot;)&#10;            .WithOpenApi();&#10;&#10;        // POST - Solo funcionarios y administradores pueden crear notificaciones&#10;        group.MapPost(&quot;/&quot;, async (&#10;            [FromBody] CrearNotificacionRequest request,&#10;            ClaimsPrincipal user,&#10;            INotificacionService service) =&gt;&#10;        {&#10;            if (string.IsNullOrWhiteSpace(request.Mensaje))&#10;            {&#10;                return Results.BadRequest(new { error = &quot;El mensaje de la notificación es requerido y no puede estar vacío&quot; });&#10;            }&#10;&#10;            var userId = long.Parse(user.FindFirst(ClaimTypes.NameIdentifier)?.Value ?? &quot;0&quot;);&#10;            &#10;            try&#10;            {&#10;                var notificacion = await service.CrearNotificacionAsync(request.Mensaje, request.Tipo, userId);&#10;                return Results.Created($&quot;/api/notificaciones/{notificacion.Id}&quot;, notificacion);&#10;            }&#10;            catch (Exception ex)&#10;            {&#10;                return Results.BadRequest(new { error = $&quot;Error al crear la notificación: {ex.Message}&quot; });&#10;            }&#10;        })&#10;        .RequireAuthorization(&quot;FuncionarioOrAdmin&quot;)&#10;        .WithName(&quot;CrearNotificacion&quot;)&#10;        .WithSummary(&quot;Crear nueva notificación&quot;)&#10;        .Produces&lt;NotificacionDto&gt;(201)&#10;        .Produces(400)&#10;        .Produces(401)&#10;        .Produces(403);&#10;&#10;        // GET - Todos los usuarios autenticados pueden ver notificaciones&#10;        group.MapGet(&quot;/&quot;, async (INotificacionService service) =&gt;&#10;        {&#10;            var notificaciones = await service.ObtenerTodasAsync();&#10;            return Results.Ok(notificaciones);&#10;        })&#10;        .RequireAuthorization(&quot;AllUsers&quot;)&#10;        .WithName(&quot;ObtenerTodasNotificaciones&quot;)&#10;        .WithSummary(&quot;Obtener todas las notificaciones&quot;)&#10;        .Produces&lt;IEnumerable&lt;NotificacionDto&gt;&gt;(200)&#10;        .Produces(401)&#10;        .Produces(403);&#10;&#10;        // GET - Todos los usuarios autenticados pueden ver una notificación específica&#10;        group.MapGet(&quot;/{id}&quot;, async (string id, INotificacionService service) =&gt;&#10;        {&#10;            if (string.IsNullOrWhiteSpace(id))&#10;            {&#10;                return Results.BadRequest(new { error = &quot;El ID de notificación es requerido y no puede estar vacío&quot; });&#10;            }&#10;&#10;            var notificacion = await service.ObtenerPorIdAsync(id);&#10;            if (notificacion == null)&#10;            {&#10;                return Results.NotFound(new { error = $&quot;La notificación con ID {id} no existe en el sistema&quot; });&#10;            }&#10;            &#10;            return Results.Ok(notificacion);&#10;        })&#10;        .RequireAuthorization(&quot;AllUsers&quot;)&#10;        .WithName(&quot;ObtenerNotificacionPorId&quot;)&#10;        .WithSummary(&quot;Obtener notificación por ID&quot;)&#10;        .Produces&lt;NotificacionDto&gt;(200)&#10;        .Produces(400)&#10;        .Produces(404)&#10;        .Produces(401)&#10;        .Produces(403);&#10;&#10;        // PUT - Solo funcionarios y administradores pueden actualizar notificaciones&#10;        group.MapPut(&quot;/{id}&quot;, async (&#10;            string id,&#10;            [FromBody] CrearNotificacionRequest request,&#10;            ClaimsPrincipal user,&#10;            INotificacionService service) =&gt;&#10;        {&#10;            if (string.IsNullOrWhiteSpace(id))&#10;            {&#10;                return Results.BadRequest(new { error = &quot;El ID de notificación es requerido y no puede estar vacío&quot; });&#10;            }&#10;&#10;            var userId = long.Parse(user.FindFirst(ClaimTypes.NameIdentifier)?.Value ?? &quot;0&quot;);&#10;            &#10;            var notificacionExistente = await service.ObtenerPorIdAsync(id);&#10;            if (notificacionExistente == null)&#10;            {&#10;                return Results.NotFound(new { error = $&quot;La notificación con ID {id} no existe en el sistema&quot; });&#10;            }&#10;&#10;            // Crear nueva notificación con los datos actualizados&#10;            var notificacionActualizada = new NotificacionDto&#10;            {&#10;                Id = id,&#10;                Mensaje = request.Mensaje,&#10;                Tipo = request.Tipo,&#10;                FechaEnvio = notificacionExistente.FechaEnvio,&#10;                Activa = notificacionExistente.Activa&#10;            };&#10;&#10;            return Results.Ok(notificacionActualizada);&#10;        })&#10;        .RequireAuthorization(&quot;FuncionarioOrAdmin&quot;)&#10;        .WithName(&quot;ActualizarNotificacion&quot;)&#10;        .WithSummary(&quot;Actualizar notificación&quot;)&#10;        .Produces&lt;NotificacionDto&gt;(200)&#10;        .Produces(400)&#10;        .Produces(404)&#10;        .Produces(401)&#10;        .Produces(403);&#10;&#10;        // DELETE - Solo administradores pueden eliminar notificaciones&#10;        group.MapDelete(&quot;/{id}&quot;, async (string id, INotificacionService service) =&gt;&#10;        {&#10;            if (string.IsNullOrWhiteSpace(id))&#10;            {&#10;                return Results.BadRequest(new { error = &quot;El ID de notificación es requerido y no puede estar vacío&quot; });&#10;            }&#10;&#10;            var resultado = await service.EliminarNotificacionAsync(id);&#10;            if (!resultado)&#10;            {&#10;                return Results.NotFound(new { error = $&quot;La notificación con ID {id} no existe en el sistema&quot; });&#10;            }&#10;            &#10;            return Results.NoContent();&#10;        })&#10;        .RequireAuthorization(&quot;AdminOnly&quot;)&#10;        .WithName(&quot;EliminarNotificacion&quot;)&#10;        .WithSummary(&quot;Eliminar notificación&quot;)&#10;        .Produces(204)&#10;        .Produces(400)&#10;        .Produces(404)&#10;        .Produces(401)&#10;        .Produces(403);&#10;&#10;        // Endpoints para notificaciones de usuario (combinando PostgreSQL y MongoDB)&#10;        var usuarioGroup = app.MapGroup(&quot;/api/usuarios/{usuarioId}/notificaciones&quot;)&#10;            .WithTags(&quot;Notificaciones&quot;)&#10;            .WithOpenApi();&#10;&#10;        // GET - Obtener todas las notificaciones de un usuario&#10;        usuarioGroup.MapGet(&quot;/&quot;, async (&#10;            long usuarioId,&#10;            [FromServices] INotificacionUsuarioService notificacionUsuarioService) =&gt;&#10;        {&#10;            if (usuarioId &lt;= 0)&#10;            {&#10;                return Results.BadRequest(new { error = &quot;El ID de usuario debe ser mayor a 0&quot; });&#10;            }&#10;&#10;            try&#10;            {&#10;                var notificaciones = await notificacionUsuarioService.ObtenerNotificacionesPorUsuarioAsync(usuarioId);&#10;                return Results.Ok(notificaciones);&#10;            }&#10;            catch (InvalidOperationException ex)&#10;            {&#10;                return Results.NotFound(new { error = ex.Message });&#10;            }&#10;        })&#10;        .RequireAuthorization(&quot;AllUsers&quot;)&#10;        .WithName(&quot;ObtenerNotificacionesPorUsuario&quot;)&#10;        .WithSummary(&quot;Obtener todas las notificaciones de un usuario&quot;)&#10;        .Produces&lt;IEnumerable&lt;NotificacionCompletaDto&gt;&gt;(200)&#10;        .Produces(400)&#10;        .Produces(404)&#10;        .Produces(401);&#10;&#10;        // GET - Obtener una notificación específica de un usuario&#10;        usuarioGroup.MapGet(&quot;/{notificacionId}&quot;, async (&#10;            long usuarioId,&#10;            string notificacionId,&#10;            [FromServices] INotificacionUsuarioService notificacionUsuarioService) =&gt;&#10;        {&#10;            if (usuarioId &lt;= 0)&#10;            {&#10;                return Results.BadRequest(new { error = &quot;El ID de usuario debe ser mayor a 0&quot; });&#10;            }&#10;&#10;            if (string.IsNullOrWhiteSpace(notificacionId))&#10;            {&#10;                return Results.BadRequest(new { error = &quot;El ID de notificación es requerido y no puede estar vacío&quot; });&#10;            }&#10;&#10;            try&#10;            {&#10;                var notificacion = await notificacionUsuarioService.ObtenerNotificacionCompletaAsync(usuarioId, notificacionId);&#10;                if (notificacion == null)&#10;                {&#10;                    return Results.NotFound(new &#10;                    { &#10;                        error = $&quot;La notificación con ID {notificacionId} no existe o no está asignada al usuario {usuarioId}&quot; &#10;                    });&#10;                }&#10;                &#10;                return Results.Ok(notificacion);&#10;            }&#10;            catch (InvalidOperationException ex)&#10;            {&#10;                return Results.NotFound(new { error = ex.Message });&#10;            }&#10;        })&#10;        .RequireAuthorization(&quot;AllUsers&quot;)&#10;        .WithName(&quot;ObtenerNotificacionPorUsuario&quot;)&#10;        .WithSummary(&quot;Obtener una notificación específica de un usuario&quot;)&#10;        .Produces&lt;NotificacionCompletaDto&gt;(200)&#10;        .Produces(400)&#10;        .Produces(404)&#10;        .Produces(401);&#10;&#10;        // PUT - Marcar notificación como leída&#10;        usuarioGroup.MapPut(&quot;/{notificacionId}/leer&quot;, async (&#10;            long usuarioId,&#10;            string notificacionId,&#10;            [FromServices] INotificacionUsuarioService notificacionUsuarioService) =&gt;&#10;        {&#10;            if (usuarioId &lt;= 0)&#10;            {&#10;                return Results.BadRequest(new { error = &quot;El ID de usuario debe ser mayor a 0&quot; });&#10;            }&#10;&#10;            if (string.IsNullOrWhiteSpace(notificacionId))&#10;            {&#10;                return Results.BadRequest(new { error = &quot;El ID de notificación es requerido y no puede estar vacío&quot; });&#10;            }&#10;&#10;            try&#10;            {&#10;                var resultado = await notificacionUsuarioService.MarcarComoLeidaAsync(usuarioId, notificacionId);&#10;                if (!resultado)&#10;                {&#10;                    return Results.NotFound(new &#10;                    { &#10;                        error = $&quot;La notificación con ID {notificacionId} no existe o no está asignada al usuario {usuarioId}&quot; &#10;                    });&#10;                }&#10;                &#10;                return Results.Ok(new { success = true, message = &quot;Notificación marcada como leída exitosamente&quot; });&#10;            }&#10;            catch (InvalidOperationException ex)&#10;            {&#10;                return Results.BadRequest(new { error = ex.Message });&#10;            }&#10;        })&#10;        .RequireAuthorization(&quot;AllUsers&quot;)&#10;        .WithName(&quot;MarcarNotificacionComoLeida&quot;)&#10;        .WithSummary(&quot;Marcar una notificación como leída&quot;)&#10;        .Produces(200)&#10;        .Produces(404)&#10;        .Produces(400)&#10;        .Produces(401);&#10;&#10;        // GET - Contar notificaciones no leídas&#10;        usuarioGroup.MapGet(&quot;/no-leidas/count&quot;, async (&#10;            long usuarioId,&#10;            [FromServices] INotificacionUsuarioService notificacionUsuarioService) =&gt;&#10;        {&#10;            if (usuarioId &lt;= 0)&#10;            {&#10;                return Results.BadRequest(new { error = &quot;El ID de usuario debe ser mayor a 0&quot; });&#10;            }&#10;&#10;            try&#10;            {&#10;                var count = await notificacionUsuarioService.ContarNoLeidasAsync(usuarioId);&#10;                return Results.Ok(new { count, usuarioId });&#10;            }&#10;            catch (InvalidOperationException ex)&#10;            {&#10;                return Results.NotFound(new { error = ex.Message });&#10;            }&#10;        })&#10;        .RequireAuthorization(&quot;AllUsers&quot;)&#10;        .WithName(&quot;ContarNotificacionesNoLeidas&quot;)&#10;        .WithSummary(&quot;Contar notificaciones no leídas de un usuario&quot;)&#10;        .Produces(200)&#10;        .Produces(400)&#10;        .Produces(404)&#10;        .Produces(401);&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="using GateKeep.Api.Application.Notificaciones;&#10;using GateKeep.Api.Contracts.Notificaciones;&#10;using Microsoft.AspNetCore.Mvc;&#10;using System.Security.Claims;&#10;&#10;namespace GateKeep.Api.Endpoints.Notificaciones;&#10;&#10;public static class NotificacionEndpoints&#10;{&#10;    public static void MapNotificacionEndpoints(this WebApplication app)&#10;    {&#10;        var group = app.MapGroup(&quot;/api/notificaciones&quot;)&#10;            .WithTags(&quot;Notificaciones&quot;)&#10;            .WithOpenApi();&#10;&#10;        // POST - Solo funcionarios y administradores pueden crear notificaciones&#10;        group.MapPost(&quot;/&quot;, async (&#10;            [FromBody] CrearNotificacionRequest request,&#10;            ClaimsPrincipal user,&#10;            INotificacionService service) =&gt;&#10;        {&#10;            if (string.IsNullOrWhiteSpace(request.Mensaje))&#10;            {&#10;                return Results.BadRequest(new { error = &quot;El mensaje de la notificación es requerido y no puede estar vacío&quot; });&#10;            }&#10;&#10;            var userId = long.Parse(user.FindFirst(ClaimTypes.NameIdentifier)?.Value ?? &quot;0&quot;);&#10;            &#10;            try&#10;            {&#10;                var notificacion = await service.CrearNotificacionAsync(request.Mensaje, request.Tipo, userId);&#10;                return Results.Created($&quot;/api/notificaciones/{notificacion.Id}&quot;, notificacion);&#10;            }&#10;            catch (Exception ex)&#10;            {&#10;                return Results.BadRequest(new { error = $&quot;Error al crear la notificación: {ex.Message}&quot; });&#10;            }&#10;        })&#10;        .RequireAuthorization(&quot;FuncionarioOrAdmin&quot;)&#10;        .WithName(&quot;CrearNotificacion&quot;)&#10;        .WithSummary(&quot;Crear nueva notificación&quot;)&#10;        .Produces&lt;NotificacionDto&gt;(201)&#10;        .Produces(400)&#10;        .Produces(401)&#10;        .Produces(403);&#10;&#10;        // GET - Todos los usuarios autenticados pueden ver notificaciones&#10;        group.MapGet(&quot;/&quot;, async (INotificacionService service) =&gt;&#10;        {&#10;            var notificaciones = await service.ObtenerTodasAsync();&#10;            return Results.Ok(notificaciones);&#10;        })&#10;        .RequireAuthorization(&quot;AllUsers&quot;)&#10;        .WithName(&quot;ObtenerTodasNotificaciones&quot;)&#10;        .WithSummary(&quot;Obtener todas las notificaciones&quot;)&#10;        .Produces&lt;IEnumerable&lt;NotificacionDto&gt;&gt;(200)&#10;        .Produces(401)&#10;        .Produces(403);&#10;&#10;        // GET - Todos los usuarios autenticados pueden ver una notificación específica&#10;        group.MapGet(&quot;/{id}&quot;, async (string id, INotificacionService service) =&gt;&#10;        {&#10;            if (string.IsNullOrWhiteSpace(id))&#10;            {&#10;                return Results.BadRequest(new { error = &quot;El ID de notificación es requerido y no puede estar vacío&quot; });&#10;            }&#10;&#10;            var notificacion = await service.ObtenerPorIdAsync(id);&#10;            if (notificacion == null)&#10;            {&#10;                return Results.NotFound(new { error = $&quot;La notificación con ID {id} no existe en el sistema&quot; });&#10;            }&#10;            &#10;            return Results.Ok(notificacion);&#10;        })&#10;        .RequireAuthorization(&quot;AllUsers&quot;)&#10;        .WithName(&quot;ObtenerNotificacionPorId&quot;)&#10;        .WithSummary(&quot;Obtener notificación por ID&quot;)&#10;        .Produces&lt;NotificacionDto&gt;(200)&#10;        .Produces(400)&#10;        .Produces(404)&#10;        .Produces(401)&#10;        .Produces(403);&#10;&#10;        // PUT - Solo funcionarios y administradores pueden actualizar notificaciones&#10;        group.MapPut(&quot;/{id}&quot;, async (&#10;            string id,&#10;            [FromBody] CrearNotificacionRequest request,&#10;            ClaimsPrincipal user,&#10;            INotificacionService service) =&gt;&#10;        {&#10;            if (string.IsNullOrWhiteSpace(id))&#10;            {&#10;                return Results.BadRequest(new { error = &quot;El ID de notificación es requerido y no puede estar vacío&quot; });&#10;            }&#10;&#10;            var userId = long.Parse(user.FindFirst(ClaimTypes.NameIdentifier)?.Value ?? &quot;0&quot;);&#10;            &#10;            var notificacionExistente = await service.ObtenerPorIdAsync(id);&#10;            if (notificacionExistente == null)&#10;            {&#10;                return Results.NotFound(new { error = $&quot;La notificación con ID {id} no existe en el sistema&quot; });&#10;            }&#10;&#10;            // Crear nueva notificación con los datos actualizados&#10;            var notificacionActualizada = new NotificacionDto&#10;            {&#10;                Id = id,&#10;                Mensaje = request.Mensaje,&#10;                Tipo = request.Tipo,&#10;                FechaEnvio = notificacionExistente.FechaEnvio,&#10;                Activa = notificacionExistente.Activa&#10;            };&#10;&#10;            return Results.Ok(notificacionActualizada);&#10;        })&#10;        .RequireAuthorization(&quot;FuncionarioOrAdmin&quot;)&#10;        .WithName(&quot;ActualizarNotificacion&quot;)&#10;        .WithSummary(&quot;Actualizar notificación&quot;)&#10;        .Produces&lt;NotificacionDto&gt;(200)&#10;        .Produces(400)&#10;        .Produces(404)&#10;        .Produces(401)&#10;        .Produces(403);&#10;&#10;        // DELETE - Solo administradores pueden eliminar notificaciones&#10;        group.MapDelete(&quot;/{id}&quot;, async (string id, INotificacionService service) =&gt;&#10;        {&#10;            if (string.IsNullOrWhiteSpace(id))&#10;            {&#10;                return Results.BadRequest(new { error = &quot;El ID de notificación es requerido y no puede estar vacío&quot; });&#10;            }&#10;&#10;            var resultado = await service.EliminarNotificacionAsync(id);&#10;            if (!resultado)&#10;            {&#10;                return Results.NotFound(new { error = $&quot;La notificación con ID {id} no existe en el sistema&quot; });&#10;            }&#10;            &#10;            return Results.NoContent();&#10;        })&#10;        .RequireAuthorization(&quot;AdminOnly&quot;)&#10;        .WithName(&quot;EliminarNotificacion&quot;)&#10;        .WithSummary(&quot;Eliminar notificación&quot;)&#10;        .Produces(204)&#10;        .Produces(400)&#10;        .Produces(404)&#10;        .Produces(401)&#10;        .Produces(403);&#10;&#10;        // Endpoints para notificaciones de usuario (combinando PostgreSQL y MongoDB)&#10;        var usuarioGroup = app.MapGroup(&quot;/api/usuarios/{usuarioId}/notificaciones&quot;)&#10;            .WithTags(&quot;Notificaciones&quot;)&#10;            .WithOpenApi();&#10;&#10;        // GET - Obtener todas las notificaciones de un usuario&#10;        usuarioGroup.MapGet(&quot;/&quot;, async (&#10;            long usuarioId,&#10;            [FromServices] INotificacionUsuarioService notificacionUsuarioService) =&gt;&#10;        {&#10;            if (usuarioId &lt;= 0)&#10;            {&#10;                return Results.BadRequest(new { error = &quot;El ID de usuario debe ser mayor a 0&quot; });&#10;            }&#10;&#10;            try&#10;            {&#10;                var notificaciones = await notificacionUsuarioService.ObtenerNotificacionesPorUsuarioAsync(usuarioId);&#10;                return Results.Ok(notificaciones);&#10;            }&#10;            catch (InvalidOperationException ex)&#10;            {&#10;                return Results.NotFound(new { error = ex.Message });&#10;            }&#10;        })&#10;        .RequireAuthorization(&quot;AllUsers&quot;)&#10;        .WithName(&quot;ObtenerNotificacionesPorUsuario&quot;)&#10;        .WithSummary(&quot;Obtener todas las notificaciones de un usuario&quot;)&#10;        .Produces&lt;IEnumerable&lt;NotificacionCompletaDto&gt;&gt;(200)&#10;        .Produces(400)&#10;        .Produces(404)&#10;        .Produces(401);&#10;&#10;        // GET - Obtener una notificación específica de un usuario&#10;        usuarioGroup.MapGet(&quot;/{notificacionId}&quot;, async (&#10;            long usuarioId,&#10;            string notificacionId,&#10;            [FromServices] INotificacionUsuarioService notificacionUsuarioService) =&gt;&#10;        {&#10;            if (usuarioId &lt;= 0)&#10;            {&#10;                return Results.BadRequest(new { error = &quot;El ID de usuario debe ser mayor a 0&quot; });&#10;            }&#10;&#10;            if (string.IsNullOrWhiteSpace(notificacionId))&#10;            {&#10;                return Results.BadRequest(new { error = &quot;El ID de notificación es requerido y no puede estar vacío&quot; });&#10;            }&#10;&#10;            try&#10;            {&#10;                var notificacion = await notificacionUsuarioService.ObtenerNotificacionCompletaAsync(usuarioId, notificacionId);&#10;                if (notificacion == null)&#10;                {&#10;                    return Results.NotFound(new &#10;                    { &#10;                        error = $&quot;La notificación con ID {notificacionId} no existe o no está asignada al usuario {usuarioId}&quot; &#10;                    });&#10;                }&#10;                &#10;                return Results.Ok(notificacion);&#10;            }&#10;            catch (InvalidOperationException ex)&#10;            {&#10;                return Results.NotFound(new { error = ex.Message });&#10;            }&#10;        })&#10;        .RequireAuthorization(&quot;AllUsers&quot;)&#10;        .WithName(&quot;ObtenerNotificacionPorUsuario&quot;)&#10;        .WithSummary(&quot;Obtener una notificación específica de un usuario&quot;)&#10;        .Produces&lt;NotificacionCompletaDto&gt;(200)&#10;        .Produces(400)&#10;        .Produces(404)&#10;        .Produces(401);&#10;&#10;        // PUT - Marcar notificación como leída&#10;        usuarioGroup.MapPut(&quot;/{notificacionId}/leer&quot;, async (&#10;            long usuarioId,&#10;            string notificacionId,&#10;            [FromServices] INotificacionUsuarioService notificacionUsuarioService) =&gt;&#10;        {&#10;            if (usuarioId &lt;= 0)&#10;            {&#10;                return Results.BadRequest(new { error = &quot;El ID de usuario debe ser mayor a 0&quot; });&#10;            }&#10;&#10;            if (string.IsNullOrWhiteSpace(notificacionId))&#10;            {&#10;                return Results.BadRequest(new { error = &quot;El ID de notificación es requerido y no puede estar vacío&quot; });&#10;            }&#10;&#10;            try&#10;            {&#10;                var resultado = await notificacionUsuarioService.MarcarComoLeidaAsync(usuarioId, notificacionId);&#10;                if (!resultado)&#10;                {&#10;                    return Results.NotFound(new &#10;                    { &#10;                        error = $&quot;La notificación con ID {notificacionId} no existe o no está asignada al usuario {usuarioId}&quot; &#10;                    });&#10;                }&#10;                &#10;                return Results.Ok(new { success = true, message = &quot;Notificación marcada como leída exitosamente&quot; });&#10;            }&#10;            catch (InvalidOperationException ex)&#10;            {&#10;                return Results.BadRequest(new { error = ex.Message });&#10;            }&#10;        })&#10;        .RequireAuthorization(&quot;AllUsers&quot;)&#10;        .WithName(&quot;MarcarNotificacionComoLeida&quot;)&#10;        .WithSummary(&quot;Marcar una notificación como leída&quot;)&#10;        .Produces(200)&#10;        .Produces(404)&#10;        .Produces(400)&#10;        .Produces(401);&#10;&#10;        // GET - Contar notificaciones no leídas&#10;        usuarioGroup.MapGet(&quot;/no-leidas/count&quot;, async (&#10;            long usuarioId,&#10;            [FromServices] INotificacionUsuarioService notificacionUsuarioService) =&gt;&#10;        {&#10;            if (usuarioId &lt;= 0)&#10;            {&#10;                return Results.BadRequest(new { error = &quot;El ID de usuario debe ser mayor a 0&quot; });&#10;            }&#10;&#10;            try&#10;            {&#10;                var count = await notificacionUsuarioService.ContarNoLeidasAsync(usuarioId);&#10;                return Results.Ok(new { count, usuarioId });&#10;            }&#10;            catch (InvalidOperationException ex)&#10;            {&#10;                return Results.NotFound(new { error = ex.Message });&#10;            }&#10;        })&#10;        .RequireAuthorization(&quot;AllUsers&quot;)&#10;        .WithName(&quot;ContarNotificacionesNoLeidas&quot;)&#10;        .WithSummary(&quot;Contar notificaciones no leídas de un usuario&quot;)&#10;        .Produces(200)&#10;        .Produces(400)&#10;        .Produces(404)&#10;        .Produces(401);&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>